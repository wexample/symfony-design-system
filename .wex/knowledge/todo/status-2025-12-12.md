# Current status â€“ Symfony Design System (Dec 12 2025)

## Rendering pipeline
- `AbstractDesignSystemController::adaptiveRender()` instantiates a DS-specific `RenderPass`, initializes layout render node (`InitialLayoutRenderNode` + trait) and injects assets/debug blocks before returning the response.
- Twig bases: `assets/bases/base.html.twig` calls `layout_initial_init()` (bootstraps layout/page services) and `assets/bases/html/default.html.twig` injects `<title>` + placeholder for assets + initial layout data via `assets/macros/assets.html.twig`.
- `LayoutExtension` exposes Twig functions `layout_initial_init` (initializes services) and `layout_render_initial_data` (serializes layout node to array, fed into `window.appRegistry.layoutRenderData`).

## Render nodes & contract
- DTOs (view/id/components/vars/usages/assets) live in `wexample/php-web-render-node`. DS package extends them with `DesignSystemRenderNodeTrait` to set default views, generate IDs, maintain `inheritanceStack`.
- Shared schema documented in `packages/COMMON/repo/web-render-node/schema.json` and summarized in `.wex/knowledge/todo/web-render-contract.md`.

## Assets & usages
- Usage types restored (default, responsive, color_scheme, margins, animations, fonts). Config loaded from `design_system.usages.*` parameters; `RenderPass` stores `usagesConfig` + current `usages` via `setUsage/getUsage`.
- `AssetsService` now mixes the new contract with legacy behaviour: builds per-usage/per-extension loops, queries `DesignSystemUsageServiceTrait::addAssetsForRenderNodeAndType`, which rebuilds public paths from view names.
- `AssetsRegistry` reinstated (reads `public/build/manifest.json`, tracks assets, resolves built/real paths). `RenderPass` instantiates it and passes it to usages so assets are created only when present in the manifest.
- Assets currently produce basic `Asset` DTOs (path/view/type/usage/context/flags) stored on render nodes; next steps include mirroring more metadata (domId, SSR flags) and generating tags.

## Shared helpers/packages
- `wexample/php-web-render-node` now contains: base `RenderPass`, `AbstractRenderNode`, `InitialLayoutRenderNode`, asset DTOs + registry, usage scaffolding, and schema-related helpers.
- Design system package extends these base classes to add legacy behaviours (IDs, views, translation domain, asset detection) while serialization stays contract-compliant.

## Outstanding work / next steps
1. Finish `DesignSystemUsageServiceTrait::createAssetIfExists()` logic (currently simplified); ensure assets inherit DOM IDs, SSR flags, and register in the new registry exactly like legacy.
2. Reintroduce AJAX render path (`AjaxLayoutRenderNode`, JSON responses) using the contract payload; ensure `layoutRenderNode->toArray()` includes page/components as needed.
3. Generate `AssetTag` equivalents or contract-compliant asset bundles from `AssetsRegistry` to inject actual `<link>/<script>` tags during SSR.
4. Start reimporting legacy layouts/components/assets (from `packages/PHP/draft/tmp/symfony-design-system`) once the pipeline is stable; keep documenting decisions in `.wex/knowledge`.
5. Mirror the contract on the JS side (future `js-web-render-node`), so front-end can consume `layoutRenderData` directly.
